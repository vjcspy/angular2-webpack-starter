<div class="cashdrawer-detail" *ngIf="shiftState.detail.shift">
  <div class="top-bar">
    <div class="grand-total">{{(shiftState.detail.amounts.totals.sales + shiftState.detail.amounts.totals.refund) |
      priceFormat}}
    </div>
  </div><!--end top-bar-->
  <div class="cashdrawer-inner" perfectScroll>
    <div class="table-total">
      <table>
        <thead>
        <tr>
          <th>&nbsp;</th>
          <th>{{ 'Sale' | translate }}</th>
          <th>{{ 'Refund' | translate }}</th>
          <th>{{ 'Net' | translate }}</th>
          <th *ngIf="!shiftIsOpening()">Counted</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let payment of getListPaymentCanUse()">
          <td>
             <span [ngClass]="{'icon-card': payment['type'] == 'credit_card',
                              'icon-wallet':payment['type'] == 'cash' || payment['type'] == 'rounding_cash',
                              'icon-payment':payment['type'] == 'payment_gateway' || payment['type']=='tyro',
                              'icon-diamond':payment['type'] == 'reward_point'}">
                        </span>
            <h4>{{payment['title']}}</h4>
          </td>
          <td>{{payment.sales | priceFormat}}</td>
          <td>{{payment.refund | priceFormat}}</td>
          <td>{{(payment.sales + payment.refund) | priceFormat}}</td>
          <td *ngIf="!shiftIsOpening()">{{shiftState.detail.shift['data']['counted'][payment['id']] | priceFormat}}</td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
          <td><h4>{{ 'Total' | translate }}</h4></td>
          <td>{{shiftState.detail.amounts.totals.sales | priceFormat}}</td>
          <td>{{shiftState.detail.amounts.totals.refund | priceFormat}}</td>
          <td>{{(shiftState.detail.amounts.totals.sales + shiftState.detail.amounts.totals.refund) | priceFormat}}</td>
          <td *ngIf="!shiftIsOpening()">{{shiftState.detail.amounts.totals.counted | priceFormat}}</td>
        </tr>
        </tfoot>
      </table><!--end table-->
    </div><!--end table-total-->

    <div class="progress-total">
      <div class="total-blk progress-tree">
        <div class="merge-row">
          <div class="p-row open-shift">
            <span class="timer">{{shiftState.detail.shift['open_at'] | datetimeFormat : 'short-time'}}</span>
            <span class="value">{{ 'Open Shift' | translate }}</span>
          </div>
          <div class="total-row">
            <p class="t-txt">
              {{shiftState.detail.shift['user_open_name']}}
              <em>"{{shiftState.detail.shift['open_note']}}"</em>
            </p>
            <p class="t-value">
              <span>{{shiftState.detail.shift['start_amount'] | priceFormat}}</span>
            </p>
          </div>
        </div>
        <div class="merge-row"
             *ngFor="let inOut of shiftState.detail.shift['in_out'];let i = index;let last = last">
          <div class="p-row" [ngClass]="{expect:inOut['is_in']==1,'un-expect':inOut['is_in']!=1}">
            <span class="timer">{{inOut['created_at'] | datetimeFormat : 'short-time'}}</span>
            <span class="value"> {{ inOut['is_in']==1?"Cash In" :"Cash Out"}}</span>
          </div>
          <div class="total-row">
            <p class="t-txt">
              {{inOut['user_name']}}
              <em>"{{inOut['note']}}"</em>
            </p>
            <p class="t-value">
              <span>{{inOut['amount']|priceFormat}}</span>
            </p>
          </div>
        </div>
        <div class="merge-row close-shift" *ngIf="!shiftIsOpening()">
          <div class="p-row close-shift">
            <span class="timer">{{shiftState.detail.shift['close_at'] | datetimeFormat : 'short-time'}}</span>
            <span class="value">{{ 'Close Shift' | translate }}</span>
          </div>
          <div class="total-row">
            <p class="t-txt">
              {{shiftState.detail.shift['user_close_name']}}
              <em>"{{shiftState.detail.shift['close_note']}}"</em>
            </p>
            <p class="t-value">
              <span class="expect">{{shiftState.detail.shift['total_counted_amount'] | priceFormat}}</span>
            </p>
          </div>
        </div>
        <div class="merge-row total-adjustment" *ngIf="!shiftIsOpening()">
          <div class="total-row">
            <h3 class="t-txt">{{ 'Total Adjustment' | translate }}</h3>
            <h3 class="t-value">{{shiftState.detail.amounts.totals.inOut | priceFormat}}</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="reward-points">
      <div class="total-blk">
        <div class="total-row">
          <h3 class="t-txt" style="width: 100%">{{ 'Reward Point & Gift Card' | translate }}</h3>
        </div>
        <div class="total-row">
          <p class="t-txt">{{ 'RP earned' | translate }}</p>
          <p class="t-value">-</p>
        </div>
        <div class="total-row">
          <p class="t-txt">{{ 'RP spent amount' | translate }}</p>
          <p class="t-value">{{getRewardPointSpent() | priceFormat}}</p>
        </div>
      </div>
    </div>

    <div class="cashdrawer-total" *ngIf="shiftState.detail.shift['is_open']!=0">
      <div class="total-blk">
        <div class="total-row">
          <p class="t-txt">{{ 'Total Tax' | translate }}</p>
          <p class="t-value" *ngIf="!!shiftState.detail.shift['total_order_tax']">
            {{shiftState.detail.shift['total_order_tax'] | priceFormat}}</p>
          <p class="t-value" *ngIf="!shiftState.detail.shift['total_order_tax']">-</p>
        </div>
        <div class="total-row"
             *ngFor="let taxDetail of shiftDetailService.convertTaxDetail(shiftState.detail.shift['detail_tax'])">
          <p class="t-txt" style="font-size: 12px; padding-left: 3%;">{{ taxDetail['label']}}</p>
          <p class="t-value" style="float: right; font-size: 12px;">{{taxDetail['value'] | priceFormat}}</p>
        </div>
      </div>
    </div>
    <div class="cashdrawer-total" *ngIf="shiftState.detail.shift['is_open']==0">
      <div class="total-blk">
        <div class="total-row">
          <p class="t-txt">{{ 'Total Tax' | translate }}</p>
          <p class="t-value" *ngIf="!!shiftState.detail.shift['total_order_tax']">
            {{shiftState.detail.shift['total_order_tax'] | priceFormat}}</p>
          <p class="t-value" *ngIf="!shiftState.detail.shift['total_order_tax']">-</p>
        </div>
        <div class="total-row"
             *ngFor="let taxDetail of shiftDetailService.convertTaxDetail(shiftState.detail.shift['detail_tax'])">
          <p class="t-txt" style="font-size: 12px; padding-left: 3%;">{{ taxDetail['label']}}</p>
          <p class="t-value" style="float: right; font-size: 12px">{{taxDetail['value'] | priceFormat}}</p>
        </div>
        <div class="total-row">
          <p class="t-txt">{{ 'Total Expected Cash In Drawer' | translate }}</p>
          <p class="t-value">{{shiftState.detail.shift['total_expected_amount'] | priceFormat}}</p>
        </div>
        <div class="total-row">
          <p class="t-txt">{{ 'Total Counted Cash In Drawer' | translate }}</p>
          <p class="t-value">{{shiftState.detail.shift['total_counted_amount'] | priceFormat}}</p>
        </div>
        <div class="total-row">
          <p class="t-txt">{{ 'Differences' | translate }}</p>
          <p class="t-value">
            {{((shiftState.detail.shift['total_counted_amount'] || 0) -
            (shiftState.detail.shift['total_expected_amount'] || 0)) | priceFormat}}
          </p>
        </div>
        <div class="total-row grand">
          <p class="t-txt">{{ 'Take out' | translate }}</p>
          <p class="t-value">{{shiftState.detail.shift['take_out_amount'] | priceFormat}}</p>
        </div>
        <div class="total-row grand">
          <p class="t-txt">{{ 'Amount Left In' | translate }}</p>
          <p class="t-value">
            {{(shiftState.detail.shift['total_counted_amount'] - shiftState.detail.shift['take_out_amount']) |
            priceFormat}}
          </p>
        </div>
      </div>
    </div>

  </div>
  <div class="bottom-bar">
    <button (click)="printShiftReport()">{{ 'Print Report' | translate }}
    </button>
    <button *ngIf="shiftIsOpening()" (click)="adjustShift()"
            [ngClass]="{disable:!authenticateService.userCan('make_adjustment_on_register')}">
      {{ 'Adjust' | translate }}
    </button>
    <button *ngIf="shiftIsOpening()" (click)="closeShift()"
            [ngClass]="{disable:!authenticateService.userCan('open_and_close_register')}">
      {{ 'Close Shift' | translate }}
    </button>
  </div>
</div>
